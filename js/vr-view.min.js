var webAr = webAr || {}, videoInfo = {}, tapCount = 0, tapclicked = !1, viewmode = "marker"; (function () { document.getElementById("info1").style.display = "inline"; webAr.scene = document.querySelector("a-scene"); var u = .5, f = .5, a = { x: 0, y: 0, z: 0 }, v = { x: 0, y: 0, z: 0 }, y = { x: 4, y: 4, z: 4 }, e = { x: 8, y: 6, z: 6 }, s = 5, o = 0, p = 0, n = 0, h = 0, r = {}, t = {}, i = {}, c = "", l = {}, w = { init: function () { var n, t, u, i, r; p = 0; document.getElementById("swPlay").style.display = "none"; this.setArg(); this.checkYukoukigen(); this.setArData() && (this.setWrap(), this.createModel(1), n = { Touch: typeof document.ontouchstart != "undefined", Pointer: window.navigator.pointerEnabled, MSPointer: window.navigator.msPointerEnabled }, this.eventNames = { start: n.Pointer ? "pointerdown" : n.MSPointer ? "MSPointerDown" : n.Touch ? "touchstart" : "mousedown", move: n.Pointer ? "pointermove" : n.MSPointer ? "MSPointerMove" : n.Touch ? "touchmove" : "mousemove", end: n.Pointer ? "pointerup" : n.MSPointer ? "MSPointerUp" : n.Touch ? "touchend" : "mouseup" }, this.setScene(), this.setOverturnEvents(), this.setResizeEvents(), this.setMoveEvents(), this.setTapEvents(), this.setPreviewEvents(), this.setMovieEvents()); t = document.getElementById("version1"); t.innerHTML = "v1.0.130"; t.addEventListener("click", function () { webAr.ar.resetGyro(); window.location.reload(!1) }); u = document.getElementById("mloader3"); u.innerHTML = "データ読み込み中・・・"; h <= 1 && (i = document.getElementById("mloader1-1"), r = document.getElementById("mloader1-2"), this.arData[0].isMarkerType == 1 ? (i.innerHTML = "対象マーカーを検出し表示します。", r.innerHTML = "マーカーに垂直にしてください。") : (i.innerHTML = "対象イメージを追跡し表示します。", r.innerHTML = "対象イメージに水平にしてください。")) }, setArg: function () { for (var h, u, i, a, f, e = this, r = {}, o = {}, t = {}, c = location.search.substring(1).split("&"), s = 0; c[s]; s++)h = c[s].split("="), r[h[0]] = decodeURIComponent(h[1]); if (r.DebugMode = r.debug && parseInt(r.debug, 10).toString(), r.targetObj = r.target ? parseInt(r.target, 10).toString() : 0, !r.xd) r.Multi = 1, r.ExDate = t[n].ed && parseInt(t[n].ed, 16).toString(10), t[0] = {}, n = 0, t[n] = r, t[n].ar = 0, r.PVList = r.pv, r.ARList = r.ar && parseInt(r.ar, 10).toString(), t[n].ARList = r.ar && parseInt(r.ar, 10).toString(), t[n].shodowList = t[n].xs && parseInt(t[n].xs, 16).toString(2), t[n].sizeList = t[n].wh && parseInt(t[n].wh, 16).toString(10), t[n].angleList = t[n].an && parseInt(t[n].an, 10).toString(2), t[n].typeList = t[n].t, t[n].markerList = t[n].m, t[n].markerList1 = t[n].m1, t[n].markerList2 = t[n].m2, t[n].ObjectList = t[n].o, t[n].ObjectList1 = t[n].o1, t[n].ObjectList2 = t[n].o2, t[n].ObjectList3 = !t[n].o3 ? t[n].o2 : t[n].o3, t[n].MkObjList = t[n].mo, o[0] = 0, l[0] = 0, t[n].OAtList = t[n].oa, t[n].OBtList = t[n].ob, t[n].OCList = t[n].oc, t[n].OZList = 0, t[n].OAZList = 0, t[n].OBZList = 0, t[n].OCZList = 0, t[n].BgList = t[n].bg, f = t[n].l && ("0000" + parseInt(t[n].l, 16).toString(10)).slice(-4), t[n].LogoList = {}, t[n].LogoAnimeList = {}, !f || (f = f.match(/.{2}/g), t[n].LogoList = f.toString().split(","), t[n].LogoAnimeList = t[n].LogoList[1] && parseInt(t[n].LogoList[1])); else { for (u = {}, u = this.readBaseXml("data/" + r.mo + "/" + r.x + ".xml"), i = {}, i = this.readPcsXml("data/" + r.mo + "/" + r.x + ".xml"), r.PVList = r.pv, r.ARList = u[0].ar && parseInt(u[0].ar, 10).toString(), r.ExDate = u[0].ed && parseInt(u[0].ed, 16).toString(10), r.WZOOM = u[0].wzoom && parseInt(u[0].wzoom, 10).toString(), r.XYZ = u[0].xyz && u[0].xyz.toString(), r.Multi = i.length, n = 0; n < r.Multi; n++)t[n] = {}, t[n].ar = 0, t[n].ARList = i[n].ar && parseInt(i[n].ar, 10).toString(), t[n].shodowList = i[n].xs && parseInt(i[n].xs, 16).toString(2), t[n].sizeList = i[n].wh && parseInt(i[n].wh, 16).toString(10), t[n].angleList = i[n].an && parseInt(i[n].an, 10).toString(2), t[n].typeList = i[n].t, t[n].markerList = i[n].m, t[n].markerList1 = i[n].m1, t[n].markerList2 = i[n].m2, t[n].ObjectList = i[n].o, t[n].ObjectList1 = i[n].o1, t[n].ObjectList2 = i[n].o2, t[n].ObjectList3 = !i[n].o3 ? i[n].o2 : i[n].o3, t[n].OAtList = i[n].oa, t[n].OBtList = i[n].ob, t[n].OCList = i[n].oc, t[n].OZList = i[n].oz && Number(i[n].oz), t[n].OAZList = i[n].oaz && Number(i[n].oaz), t[n].OBZList = i[n].obz && Number(i[n].obz), t[n].OCZList = i[n].ocz && Number(i[n].ocz), t[n].BgList = i[n].bg, t[n].MkObjList = i[n].mo, o[n] = 0, l[n] = 0, f = i[n].l && ("0000" + parseInt(i[n].l, 16).toString(10)).slice(-4), t[n].LogoList = {}, t[n].LogoAnimeList = {}, !f || (f = f.match(/.{2}/g), t[n].LogoList = f.toString().split(","), t[n].LogoAnimeList = t[n].LogoList[1] && parseInt(t[n].LogoList[1])); r.Multi > 1 && (a = document.getElementById("imgMulti"), a.src = "asset/markers-w.png") } r.DebugMode || (document.getElementById("debug1").style.display = "none", document.getElementById("debug2").style.display = "none", document.getElementById("debug3").style.display = "none"); e.arg = r; e.args = t; e.viewIdx = o; e.videoState = l }, checkYukoukigen: function () { var t = this, i = new Date, e = i.getFullYear(), r = i.getMonth() + 1, u = i.getDate(), n, f; r = ("0" + r).slice(-2); u = ("0" + u).slice(-2); !t.arg.ExDate || parseInt(t.arg.ExDate.toString()).toString(10) < (e + r + u).toString() && (n = t.arg.ExDate.toString(), f = n.substr(0, 4) + "年" + n.substr(4, 2) + "月" + n.substr(6, 2) + "日", this.Err_Exit("表示期限は、" + f + " です。\n表示期限が終了しているため、表示することができません。")) }, setArData: function () { var u = this, b = {}, r = {}, c = document.createElement("a-assets"), k, p, d, a, y, f, e, o, i, s, w; for (c.setAttribute("id", "arAssets" + (n + 1).toString()), c.setAttribute("timeout", "9000"), n = 0; n < u.arg.Multi; n++) { b[n] = null; r[n] = {}; t[n] = {}; var g = u.args[n].typeList ? GetFileType(String(u.args[n].typeList)) : GetFileType(""), l = {}, nt = "", v = 1; if (u.args[n].ObjectList) l[0] = u.args[n].ObjectList ? u.args[n].ObjectList : ""; else for (v = Number(u.args[n].ObjectList3) - Number(u.args[n].ObjectList2), k = Number(u.args[n].ObjectList2), i = 0; i <= v; i++)p = k + i < 100 ? 2 : (k + i).toString().length, d = ("0".repeat(p) + parseInt(k + i, 10).toString()).slice(-p), l[i] = u.args[n].MkObjList && d ? u.args[n].MkObjList + "/" + d : u.args[n].ObjectList1 + "/" + d; if (nt = u.args[n].MkObjList ? u.args[n].MkObjList : u.args[n].ObjectList1 ? u.args[n].ObjectList1 : u.args[n].ObjectList, r[n] = { path: l[0] + "." + g }, r[n].oType = g, r[n].paths = {}, r[n].ObjectPath = {}, r[n].srcno = { obj: 1, from: 1, to: 1, length: 1 }, v > 1) for (r[n].srcno.length = 0, i = 0; i <= v; i++)r[n].paths[i] = l[i] + "." + r[n].oType, r[n].ObjectPath[i] = {}, !u.args[n].OAtList || (r[n].ObjectPath[i].A = l[i] + "-a." + r[n].oType), !u.args[n].OBtList || (r[n].ObjectPath[i].B = l[i] + "-b." + r[n].oType), !u.args[n].OCtList || (r[n].ObjectPath[i].C = l[i] + "-c." + r[n].oType), r[n].srcno.length += 1; else r[n].paths[0] = l[0] + "." + r[n].oType, r[n].ObjectPath[0] = {}, !u.args[n].OAtList || (r[n].ObjectPath[0].A = l[0] + "-a." + r[n].oType), !u.args[n].OBtList || (r[n].ObjectPath[0].B = l[0] + "-b." + r[n].oType), !u.args[n].OCtList || (r[n].ObjectPath[0].C = l[0] + "-c." + r[n].oType); h < r[n].srcno.length && (h = r[n].srcno.length); r[n].isPng = !!(r[n].path || "").match(/\.png$/i); r[n].isGif = !!(r[n].path || "").match(/\.gif$/i); r[n].isMp4 = !!(r[n].path || "").match(/\.mp4$/i); r[n].isGltf = !!(r[n].path || "").match(/\.gltf$/i); r[n].isPV = !!u.arg.PVList; r[n].isNFT = !!u.arg.ARList; r[n].isMarkerType = !u.args[n].ARList ? 1 : Number(u.args[n].ARList); r[n].isLogo = !u.args[n].LogoList ? "0" : u.args[n].LogoList[0]; r[n].isAnime = !u.args[n].LogoAnimeList ? 0 : Number(u.args[n].LogoAnimeList); r[n].isShadow = u.args[n].shodowList && !!Number(u.args[n].shodowList); u.args[n].sizeList = String(!(!!u.args[n].sizeList && !r[n].isPV) ? GetDefaultSize(r[n].isMarkerType == 1 ? 0 : 1, r[n].oType) : u.args[n].sizeList); var tt = SizeSplit(u.args[n].sizeList).toString().split(","), i = parseInt(u.args[n].sizeList).toString(10).length % 2 == 0 ? parseInt(u.args[n].sizeList).toString(10).length : parseInt(u.args[n].sizeList).toString(10).length + 1, p = r[n].isMarkerType == 1 ? 2 : 2; if (r[n].size = { w: (Number(tt[0]) * 10 ** -((i - p) / 2)).toFixed(1), h: (Number(tt[1]) * 10 ** -((i - p) / 2)).toFixed(1) }, t[n].Scale = { x: r[n].size.w, y: r[n].size.h, z: r[n].size.h }, r[n].path) { if (a = !r[n].isMp4 ? !r[n].isGltf ? "pic" : "gltf" : "video", r[n].path = rootPath + "article/" + a + "/" + r[n].path, r[n].arObj = {}, !r[n].isPng && !r[n].isGif) if (!r[n].isMp4) { if (r[n].isGltf) for (s = {}, i = 0; i <= v; i++)r[n].paths[i] = rootPath + "article/" + a + "/" + r[n].paths[i], s[i] = document.createElement("a-asset-item"), s[i].setAttribute("crossorigin", "anonymous"), s[i].setAttribute("id", "source" + ((n + 1) * 100 + (i + 1)).toString()), s[i].setAttribute("src", r[n].paths[i]), r[n].arObj[i] = { obj: s[i] }, c.appendChild(s[i]) } else for (e = {}, o = {}, i = 0; i <= v; i++)r[n].paths[i] = rootPath + "article/" + a + "/" + r[n].paths[i], e[i] = document.createElement("video"), e[i].setAttribute("src", r[n].paths[i]), e[i].setAttribute("id", "source" + ((n + 1) * 100 + (i + 1)).toString()), e[i].setAttribute("preload", "auto"), e[i].setAttribute("response-type", "arraybuffer"), e[i].setAttribute("loop", "true"), e[i].setAttribute("crossorigin", "anonymous"), e[i].setAttribute("webkit-playsinline", "webkit-playsinline"), e[i].setAttribute("playsinline", ""), e[i].setAttribute("controls", ""), e[i].setAttribute("autoplay", ""), o[i] = document.createElement("audio"), o[i].setAttribute("src", r[n].paths[i]), o[i].setAttribute("id", "asource" + ((n + 1) * 100 + (i + 1)).toString()), o[i].setAttribute("preload", "auto"), o[i].setAttribute("response-type", "arraybuffer"), o[i].setAttribute("loop", "true"), o[i].setAttribute("crossorigin", "anonymous"), o[i].setAttribute("webkit-playsinline", "webkit-playsinline"), o[i].setAttribute("playsinline", ""), o[i].setAttribute("controls", ""), o[i].setAttribute("autoplay", ""), r[n].arObj[i] = { obj: e[i], obj2: o[i] }, c.appendChild(e[i]), c.appendChild(o[i]); else for (y = {}, f = {}, i = 0; i <= v; i++)r[n].paths[i] = rootPath + "article/" + a + "/" + r[n].paths[i], y[i] = document.createElement("img"), y[i].setAttribute("crossorigin", "anonymous"), y[i].setAttribute("id", "source" + ((n + 1) * 100 + (i + 1)).toString()), y[i].setAttribute("src", r[n].paths[i]), r[n].arObj[i] = { obj: y[i] }, c.appendChild(y[i]), f[i] = {}, !u.args[n].OAtList || (r[n].ObjectPath[i].A = rootPath + "article/" + a + "/" + r[n].ObjectPath[i].A, f[i].A = document.createElement("img"), f[i].A.setAttribute("crossorigin", "anonymous"), f[i].A.setAttribute("id", "asource" + ((n + 1) * 100 + (i + 1)).toString()), f[i].A.setAttribute("src", r[n].ObjectPath[i].A), r[n].arObj[i][1] = f[i].A, c.appendChild(f[i].A)), !u.args[n].OBtList || (r[n].ObjectPath[i].B = rootPath + "article/" + a + "/" + r[n].ObjectPath[i].B, f[i].B = document.createElement("img"), f[i].B.setAttribute("crossorigin", "anonymous"), f[i].B.setAttribute("id", "bsource" + ((n + 1) * 100 + (i + 1)).toString()), f[i].B.setAttribute("src", r[n].ObjectPath[i].B), r[n].arObj[i][2] = f[i].B, c.appendChild(f[i].B)), !u.args[n].OCtList || (r[n].ObjectPath[i].C = rootPath + "article/" + a + "/" + r[n].ObjectPath[i].C, f[i].C = document.createElement("img"), f[i].C.setAttribute("crossorigin", "anonymous"), f[i].C.setAttribute("id", "csource" + ((n + 1) * 100 + (i + 1)).toString()), f[i].C.setAttribute("src", r[n].ObjectPath[i].C), r[n].arObj[i][3] = f[i].C, c.appendChild(f[i].C)); r[n].isLogo && (r[n].logopath = rootPath + "article/gltf/" + nt + "/logo-" + u.args[n].LogoList[0] + ".gltf", s = document.createElement("a-asset-item"), s.setAttribute("crossorigin", "anonymous"), s.setAttribute("id", "lsource" + ((n + 1) * 100 + 1).toString()), s.setAttribute("src", r[n].logopath), c.appendChild(s)); r[n].tap && (u.tap = !0, w = document.createElement("img"), w.setAttribute("crossorigin", "anonymous"), w.setAttribute("id", "swDown"), w.setAttribute("src", "asset/touch_w.png"), document.body.appendChild(w)) } if (b[n] = r[n], !b[n].path) return this.Err_Exit("画像情報が取得できませんでした。"), !1 } return webAr.scene.appendChild(c), u.arData = b, !0 }, setSwitcher: function () { var i = this, n = document.getElementById("swMarker"), t = document.getElementById("swPreview"); i.arData[0].isPV ? t.classList.add("current") : n.classList.add("current"); n.addEventListener("click", function () { if (!this.classList.contains("current")) { webAr.markerIdx = ""; location.replace(location.search.replace("&pv=1", "")); for (var n = 0; n < webAr.ar.arg.Multi; n++)webAr.ar.videoState[n] = 0; this.setDiplayBtn(0) } }); t.addEventListener("click", function () { if (!this.classList.contains("current")) { webAr.markerIdx = "1"; location.replace(location.search + "&pv=1"); for (var n = 0; n < webAr.ar.arg.Multi; n++)webAr.ar.videoState[n] = 0; this.setDiplayBtn(1) } }) }, setWrap: function () { var t = this, u, i, f; for (t.wrap = [], n = 0; n < t.arg.Multi; n++)r[n] = { Pos: v, Scale: y }, u = !t.args[n].angleList ? 0 : Number(t.args[n].angleList), i = document.createElement("a-entity"), i.setAttribute("id", "base" + (n + 1).toString()), i.setAttribute("scale", AFRAME.utils.coordinates.stringify(r[n].Scale)), t.arData[n].isPV || !t.arg.XYZ || (f = AFRAME.utils.coordinates.parse(t.arg.XYZ), r[n].Pos = f), i.setAttribute("position", AFRAME.utils.coordinates.stringify(r[n].Pos)), i.setAttribute("rotation", u + " 0 0"), i.setAttribute("src", rootPath + "asset/plane.png"), i.setAttribute("material", "transparent: true, opacity: 0"), i.setAttribute("style", "z-index: 5"), i.setAttribute("visible", !0), t.wrap[n] = i, t.arData[n].wrap = t.wrap[n] }, createModel: function (r) { var o = this, s = o.arData, k, p, tt, w, it, b, rt, d, h, y, c, ut, l, ft, v, et, g, nt; for (n = 0; n < o.arg.Multi; n++)if (s[n].path) { var ot = "#source" + ((n + 1) * 100 + r).toString(), st = "#asource" + ((n + 1) * 100 + r).toString(), ht = "#bsource" + ((n + 1) * 100 + r).toString(), ct = "#csource" + ((n + 1) * 100 + r).toString(); s[n].isShadow && (k = document.createElement("a-image"), k.setAttribute("id", "shadow" + (n + 1).toString()), k.setAttribute("position", AFRAME.utils.coordinates.stringify(o.positionVec3("shadow", n))), k.setAttribute("rotation", "-90 0 0"), k.setAttribute("style", "z-index: 2"), AFRAME.utils.entity.setComponentProperty(k, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x }), AFRAME.utils.entity.setComponentProperty(k, "material", { shader: s.isGif ? "gif" : "flat", npot: !0, src: ot, transparent: !0, alphaTest: f, color: "black", opacity: u, depthTest: !1 }), o.arData[n].shadow = k, o.args[n].OAtList && (p = document.createElement("a-image"), tt = { x: posVec3shadow.x, y: posVec3shadow.y, z: Number(posVec3shadow.z) }, t[n].posVec3ashadowa = tt, p.setAttribute("id", "ashadow" + (n + 1).toString()), p.setAttribute("position", AFRAME.utils.coordinates.stringify(tt)), p.setAttribute("rotation", "-90 0 0"), p.setAttribute("style", "z-index: 2"), p.setAttribute("visible", !o.arg.targetObj), AFRAME.utils.entity.setComponentProperty(p, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x }), AFRAME.utils.entity.setComponentProperty(p, "material", { shader: s.isGif ? "gif" : "flat", npot: !0, src: st, transparent: !0, alphaTest: f, color: "black", opacity: u, depthTest: !1 }), o.arData[n].ashadow = p), o.args[n].OBtList && (w = document.createElement("a-image"), it = { x: posVec3shadow.x, y: posVec3shadow.y, z: Number(posVec3shadow.z) }, t[n].posVec3bshadow = it, w.setAttribute("id", "ashadow" + (n + 1).toString()), w.setAttribute("position", AFRAME.utils.coordinates.stringify(it)), w.setAttribute("rotation", "-90 0 0"), w.setAttribute("style", "z-index: 2"), w.setAttribute("visible", !o.arg.targetObj), AFRAME.utils.entity.setComponentProperty(w, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x }), AFRAME.utils.entity.setComponentProperty(w, "material", { shader: s.isGif ? "gif" : "flat", npot: !0, src: ht, transparent: !0, alphaTest: f, color: "black", opacity: u, depthTest: !1 }), o.arData[n].bshadow = w), o.args[n].OCtList && (b = document.createElement("a-image"), rt = { x: posVec3shadow.x, y: posVec3shadow.y, z: Number(posVec3shadow.z) }, t[n].posVec3cshadow = rt, b.setAttribute("id", "ashadow" + (n + 1).toString()), b.setAttribute("position", AFRAME.utils.coordinates.stringify(rt)), b.setAttribute("rotation", "-90 0 0"), b.setAttribute("style", "z-index: 2"), b.setAttribute("visible", !o.arg.targetObj), AFRAME.utils.entity.setComponentProperty(b, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x }), AFRAME.utils.entity.setComponentProperty(b, "material", { shader: s.isGif ? "gif" : "flat", npot: !0, src: ct, transparent: !0, alphaTest: f, color: "black", opacity: u, depthTest: !1 }), o.arData[n].cshadow = b)); d = ""; s[n].isMp4 ? s[n].isMp4 && (d = "a-video") : d = "a-image"; h = document.createElement(d); y = o.positionVec3("main", n); a = y; t[n].Pos = y; h.setAttribute("id", "main" + (n + 1).toString()); h.setAttribute("position", AFRAME.utils.coordinates.stringify(t[n].Pos)); s[n].isGif ? h.setAttribute("rotation", "-30 0 0") : (h.setAttribute("rotation", AFRAME.utils.coordinates.stringify("0 0 0")), s[n].isGltf ? h.setAttribute("scale", AFRAME.utils.coordinates.stringify(t[n].Scale)) : (h.setAttribute("width", AFRAME.utils.coordinates.stringify(t[n].Scale.x)), h.setAttribute("height", AFRAME.utils.coordinates.stringify(t[n].Scale.y)), h.setAttribute("style", "z-index: 3"), s[n].isMp4 && h.setAttribute("play", "true"), AFRAME.utils.entity.setComponentProperty(h, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x, segmentsHeight: 1, segmentsWidth: 1 }), AFRAME.utils.entity.setComponentProperty(h, "material", { shader: s.isGif ? "gif" : "standard", npot: !0, src: ot, displacementMap: null, displacementBias: -.5, side: "double", transparent: !0, alphaTest: .1, metalness: 0, roughness: .5 }))); o.arData[n].main = h; var lt = { 0: o.args[n].OAtList, 1: o.args[n].OBtList, 2: o.args[n].OCtList }, at = { 0: o.args[n].OAZList, 1: o.args[n].OBZList, 2: o.args[n].OCZList }; o.args[n].OAtList && (c = document.createElement(d), ut = { x: Number(y.x), y: Number(y.y), z: Number(y.z) + Number(o.args[n].OAZList) }, t[n].posVec3a = ut, c.setAttribute("id", "amain" + (n + 1).toString()), c.setAttribute("position", AFRAME.utils.coordinates.stringify(ut)), s[n].isGif ? c.setAttribute("rotation", "-30 0 0") : (c.setAttribute("rotation", AFRAME.utils.coordinates.stringify("0 0 0")), s[n].isGltf ? c.setAttribute("scale", AFRAME.utils.coordinates.stringify(t[n].Scale)) : (c.setAttribute("width", AFRAME.utils.coordinates.stringify(t[n].Scale.x)), c.setAttribute("height", AFRAME.utils.coordinates.stringify(t[n].Scale.y)), c.setAttribute("style", "z-index: 4"), s[n].isMp4 && c.setAttribute("play", "true"), AFRAME.utils.entity.setComponentProperty(c, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x, segmentsHeight: 1, segmentsWidth: 1 }), AFRAME.utils.entity.setComponentProperty(c, "material", { shader: s.isGif ? "gif" : "standard", npot: !0, src: st, displacementMap: null, displacementBias: -.5, side: "double", transparent: !0, alphaTest: .1, metalness: 0, roughness: .5 }))), o.arData[n].amain = c); o.args[n].OBtList && (l = document.createElement(d), ft = { x: Number(y.x), y: Number(y.y), z: Number(y.z) + Number(o.args[n].OBZList) }, t[n].posVec3b = ft, l.setAttribute("id", "bmain" + (n + 1).toString()), l.setAttribute("position", AFRAME.utils.coordinates.stringify(ft)), s[n].isGif ? l.setAttribute("rotation", "-30 0 0") : (l.setAttribute("rotation", AFRAME.utils.coordinates.stringify("0 0 0")), s[n].isGltf ? l.setAttribute("scale", AFRAME.utils.coordinates.stringify(t[n].Scale)) : (l.setAttribute("width", AFRAME.utils.coordinates.stringify(t[n].Scale.x)), l.setAttribute("height", AFRAME.utils.coordinates.stringify(t[n].Scale.y)), l.setAttribute("style", "z-index: 4"), s[n].isMp4 && l.setAttribute("play", "true"), AFRAME.utils.entity.setComponentProperty(l, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x, segmentsHeight: 1, segmentsWidth: 1 }), AFRAME.utils.entity.setComponentProperty(l, "material", { shader: s.isGif ? "gif" : "standard", npot: !0, src: ht, displacementMap: null, displacementBias: -.5, side: "double", transparent: !0, alphaTest: .1, metalness: 0, roughness: .5 }))), o.arData[n].bmain = l); o.args[n].OCtList && (v = document.createElement(d), et = { x: Number(y.x), y: Number(y.y), z: Number(y.z) + Number(o.args[n].OCZList) }, t[n].posVec3c = et, v.setAttribute("id", "cmain" + (n + 1).toString()), v.setAttribute("position", AFRAME.utils.coordinates.stringify(et)), s[n].isGif ? v.setAttribute("rotation", "-30 0 0") : (v.setAttribute("rotation", AFRAME.utils.coordinates.stringify("0 0 0")), s[n].isGltf ? v.setAttribute("scale", AFRAME.utils.coordinates.stringify(t[n].Scale)) : (v.setAttribute("width", AFRAME.utils.coordinates.stringify(t[n].Scale.x)), v.setAttribute("height", AFRAME.utils.coordinates.stringify(t[n].Scale.y)), v.setAttribute("style", "z-index: 4"), s[n].isMp4 && v.setAttribute("play", "true"), AFRAME.utils.entity.setComponentProperty(v, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x, segmentsHeight: 1, segmentsWidth: 1 }), AFRAME.utils.entity.setComponentProperty(v, "material", { shader: s.isGif ? "gif" : "standard", npot: !0, src: ct, displacementMap: null, displacementBias: -.5, side: "double", transparent: !0, alphaTest: .1, metalness: 0, roughness: .5 }))), o.arData[n].cmain = v); s[n].isLogo && (g = document.createElement("a-entity"), nt = s[n].isMp4 ? 2 : 1, i[n] = { Pos: o.positionVec3Logo(Number(s[n].isAnime), n), Scale: e.x * nt + " " + e.y * nt + " " + e.z * nt }, g.setAttribute("id", "logo" + (n + 1).toString()), g.setAttribute("position", AFRAME.utils.coordinates.stringify(i[n].Pos)), g.setAttribute("scale", AFRAME.utils.coordinates.stringify(i[n].Scale)), g.setAttribute("gltf-model", "#lsource" + ((n + 1) * 100 + 1).toString()), g.setAttribute("style", "z-index: 4"), o.arData[n].logo = g) } }, resetModel: function (n, r) { var s = this, o = s.arData, nt, b, y, tt, p, it, w, rt, k, h, v, c, ut, l, ft, a, et, d, g; o[n].path && (nt = "#source" + ((Number(n) + 1) * 100 + r).toString(), o[n].isShadow && (b = document.createElement("a-image"), b.setAttribute("id", "shadow" + (n + 1).toString()), b.setAttribute("position", AFRAME.utils.coordinates.stringify(s.positionVec3("shadow", n))), b.setAttribute("rotation", "-90 0 0"), b.setAttribute("style", "z-index: 2"), AFRAME.utils.entity.setComponentProperty(b, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x }), AFRAME.utils.entity.setComponentProperty(b, "material", { shader: o.isGif ? "gif" : "flat", npot: !0, src: nt, transparent: !0, alphaTest: .1, color: "black", opacity: .3, depthTest: !1 }), s.arData[n].shadow = b, s.args[n].OAtList && (y = document.createElement("a-image"), tt = { x: posVec3shadow.x, y: posVec3shadow.y, z: Number(posVec3shadow.z) }, t[n].posVec3ashadowa = tt, y.setAttribute("id", "ashadow" + (n + 1).toString()), y.setAttribute("position", AFRAME.utils.coordinates.stringify(tt)), y.setAttribute("rotation", "-90 0 0"), y.setAttribute("style", "z-index: 2"), y.setAttribute("visible", !s.arg.targetObj), AFRAME.utils.entity.setComponentProperty(y, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x }), AFRAME.utils.entity.setComponentProperty(y, "material", { shader: o.isGif ? "gif" : "flat", npot: !0, src: asrcname, transparent: !0, alphaTest: f, color: "black", opacity: u, depthTest: !1 }), s.arData[n].ashadow = y), s.args[n].OBtList && (p = document.createElement("a-image"), it = { x: posVec3shadow.x, y: posVec3shadow.y, z: Number(posVec3shadow.z) }, t[n].posVec3bshadow = it, p.setAttribute("id", "ashadow" + (n + 1).toString()), p.setAttribute("position", AFRAME.utils.coordinates.stringify(it)), p.setAttribute("rotation", "-90 0 0"), p.setAttribute("style", "z-index: 2"), p.setAttribute("visible", !s.arg.targetObj), AFRAME.utils.entity.setComponentProperty(p, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x }), AFRAME.utils.entity.setComponentProperty(p, "material", { shader: o.isGif ? "gif" : "flat", npot: !0, src: bsrcname, transparent: !0, alphaTest: f, color: "black", opacity: u, depthTest: !1 }), s.arData[n].bshadow = p), s.args[n].OCtList && (w = document.createElement("a-image"), rt = { x: posVec3shadow.x, y: posVec3shadow.y, z: Number(posVec3shadow.z) }, t[n].posVec3cshadow = rt, w.setAttribute("id", "ashadow" + (n + 1).toString()), w.setAttribute("position", AFRAME.utils.coordinates.stringify(rt)), w.setAttribute("rotation", "-90 0 0"), w.setAttribute("style", "z-index: 2"), w.setAttribute("visible", !s.arg.targetObj), AFRAME.utils.entity.setComponentProperty(w, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x }), AFRAME.utils.entity.setComponentProperty(w, "material", { shader: o.isGif ? "gif" : "flat", npot: !0, src: csrcname, transparent: !0, alphaTest: f, color: "black", opacity: u, depthTest: !1 }), s.arData[n].cshadow = w)), k = "", o[n].isMp4 ? o[n].isMp4 && (k = "a-video") : k = "a-image", h = document.createElement(k), v = s.positionVec3("main", n), t[n].Pos = v, h.setAttribute("id", "main" + (n + 1).toString()), h.setAttribute("position", AFRAME.utils.coordinates.stringify(t[n].Pos)), o[n].isGif ? h.setAttribute("rotation", "-30 0 0") : (h.setAttribute("rotation", AFRAME.utils.coordinates.stringify("0 0 0")), o[n].isGltf ? h.setAttribute("scale", AFRAME.utils.coordinates.stringify(t[n].Scale)) : (h.setAttribute("width", AFRAME.utils.coordinates.stringify(t[n].Scale.x)), h.setAttribute("height", AFRAME.utils.coordinates.stringify(t[n].Scale.y)), h.setAttribute("style", "z-index: 3"), o[n].isMp4 && h.setAttribute("play", "true"), AFRAME.utils.entity.setComponentProperty(h, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x, segmentsHeight: 1, segmentsWidth: 1 }), AFRAME.utils.entity.setComponentProperty(h, "material", { shader: o.isGif ? "gif" : "standard", npot: !0, src: nt, displacementMap: null, displacementBias: -.5, side: "double", transparent: !0, alphaTest: .1, metalness: 0, roughness: .5 }))), s.arData[n].main = h, s.args[n].OAtList && (c = document.createElement(k), ut = { x: Number(v.x), y: Number(v.y), z: Number(v.z) + Number(s.args[n].OAZList) }, t[n].posVec3a = ut, c.setAttribute("id", "amain" + (n + 1).toString()), c.setAttribute("position", AFRAME.utils.coordinates.stringify(ut)), o[n].isGif ? c.setAttribute("rotation", "-30 0 0") : (c.setAttribute("rotation", AFRAME.utils.coordinates.stringify("0 0 0")), o[n].isGltf ? c.setAttribute("scale", AFRAME.utils.coordinates.stringify(t[n].Scale)) : (c.setAttribute("width", AFRAME.utils.coordinates.stringify(t[n].Scale.x)), c.setAttribute("height", AFRAME.utils.coordinates.stringify(t[n].Scale.y)), c.setAttribute("style", "z-index: 4"), o[n].isMp4 && c.setAttribute("play", "true"), AFRAME.utils.entity.setComponentProperty(c, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x, segmentsHeight: 1, segmentsWidth: 1 }), AFRAME.utils.entity.setComponentProperty(c, "material", { shader: o.isGif ? "gif" : "standard", npot: !0, src: asrcname, displacementMap: null, displacementBias: -.5, side: "double", transparent: !0, alphaTest: .1, metalness: 0, roughness: .5 }))), s.arData[n].amain = c), s.args[n].OBtList && (l = document.createElement(k), ft = { x: Number(v.x), y: Number(v.y), z: Number(v.z) + Number(s.args[n].OBZList) }, t[n].posVec3b = ft, l.setAttribute("id", "bmain" + (n + 1).toString()), l.setAttribute("position", AFRAME.utils.coordinates.stringify(ft)), o[n].isGif ? l.setAttribute("rotation", "-30 0 0") : (l.setAttribute("rotation", AFRAME.utils.coordinates.stringify("0 0 0")), o[n].isGltf ? l.setAttribute("scale", AFRAME.utils.coordinates.stringify(t[n].Scale)) : (l.setAttribute("width", AFRAME.utils.coordinates.stringify(t[n].Scale.x)), l.setAttribute("height", AFRAME.utils.coordinates.stringify(t[n].Scale.y)), l.setAttribute("style", "z-index: 4"), o[n].isMp4 && l.setAttribute("play", "true"), AFRAME.utils.entity.setComponentProperty(l, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x, segmentsHeight: 1, segmentsWidth: 1 }), AFRAME.utils.entity.setComponentProperty(l, "material", { shader: o.isGif ? "gif" : "standard", npot: !0, src: bsrcname, displacementMap: null, displacementBias: -.5, side: "double", transparent: !0, alphaTest: .1, metalness: 0, roughness: .5 }))), s.arData[n].bmain = l), s.args[n].OCtList && (a = document.createElement(k), et = { x: Number(v.x), y: Number(v.y), z: Number(v.z) + Number(s.args[n].OCZList) }, t[n].posVec3c = et, a.setAttribute("id", "cmain" + (n + 1).toString()), a.setAttribute("position", AFRAME.utils.coordinates.stringify(et)), o[n].isGif ? a.setAttribute("rotation", "-30 0 0") : (a.setAttribute("rotation", AFRAME.utils.coordinates.stringify("0 0 0")), o[n].isGltf ? a.setAttribute("scale", AFRAME.utils.coordinates.stringify(t[n].Scale)) : (a.setAttribute("width", AFRAME.utils.coordinates.stringify(t[n].Scale.x)), a.setAttribute("height", AFRAME.utils.coordinates.stringify(t[n].Scale.y)), a.setAttribute("style", "z-index: 4"), o[n].isMp4 && a.setAttribute("play", "true"), AFRAME.utils.entity.setComponentProperty(a, "geometry", { primitive: "plane", height: t[n].Scale.y, width: t[n].Scale.x, segmentsHeight: 1, segmentsWidth: 1 }), AFRAME.utils.entity.setComponentProperty(a, "material", { shader: o.isGif ? "gif" : "standard", npot: !0, src: csrcname, displacementMap: null, displacementBias: -.5, side: "double", transparent: !0, alphaTest: .1, metalness: 0, roughness: .5 }))), s.arData[n].cmain = a), o[n].isLogo && (d = document.createElement("a-entity"), g = o[n].isMp4 ? 2 : 1, i[n] = { Pos: s.positionVec3Logo(Number(o[n].isAnime), n), Scale: e.x * g + " " + e.y * g + " " + e.z * g }, d.setAttribute("id", "logo" + (n + 1).toString()), d.setAttribute("position", AFRAME.utils.coordinates.stringify(i[n].Pos)), d.setAttribute("scale", AFRAME.utils.coordinates.stringify(i[n].Scale)), d.setAttribute("gltf-model", "#lsource" + ((n + 1) * 100 + 1).toString()), d.setAttribute("style", "z-index: 4"), s.arData[n].logo = d)) }, createAnimation: function (t) { var r = this, u = r.arData, f; !u[t].isLogo || (f = u[t].isMp4 ? 2 : 1, r.arData[t].logo.setAttribute("position", AFRAME.utils.coordinates.stringify(i[t].Pos)), u[t].isAnime ? (r.arData[t].logo.setAttribute("radius", i[t].Scale.x / 2), u[t].isAnime == 1 ? AFRAME.utils.entity.setComponentProperty(r.arData[t].logo, "animation__turn", { property: "rotation", from: "0 0 0", to: "0 360 0", dur: 3e3, loop: !0, easing: "linear" }) : u[t].isAnime == 2 ? AFRAME.utils.entity.setComponentProperty(r.arData[t].logo, "animation__turn", { property: "rotation", from: "0 0 0", to: "0 360 0", dur: 3e3, loop: !0, easing: "easeOutElastic", elasticity: 300 }) : u[n].isAnime == 3 ? (r.arData[t].logo.setAttribute("rotation", AFRAME.utils.coordinates.stringify("0 0 0")), AFRAME.utils.entity.setComponentProperty(r.arData[t].logo, "animation__pos", { property: "position", dir: "alternate", dur: 400, easing: "easeInOutQuart", loop: !0, from: logopos.x + " " + i[t].Pos.y + " " + i[t].Pos.z, to: logopos.x + " " + (i[t].Pos.y + i[t].Scale.y * f / 5) + " " + i[t].Pos.z }), AFRAME.utils.entity.setComponentProperty(r.arData[t].logo, "animation__scale", { property: "scale", dir: "alternate", dur: 400, easing: "easeOutQuad", loop: !0, from: i[t].Scale.x * 1.2 + " " + i[t].Scale.y * .8 + " " + i[t].Scale.z, to: i[t].Scale.x * .8 + " " + i[t].Scale.y * 1.2 + " " + i[t].Scale.z })) : u[t].isAnime == 11 ? AFRAME.utils.entity.setComponentProperty(r.arData[t].logo, "animation__turn1", { property: "rotation", dur: 3e3, easing: "linear", from: "0 0 0", to: "0 360 0", startEvents: "turn1" }) : u[t].isAnime == 12 ? AFRAME.utils.entity.setComponentProperty(r.arData[t].logo, "animation__turn2", { property: "rotation", dur: 3e3, easing: "easeOutElastic", elasticity: 300, from: "0 0 0", to: "0 360 0", startEvents: "turn2" }) : u[n].isAnime == 13 && (r.arData[t].logo.setAttribute("rotation", AFRAME.utils.coordinates.stringify("0 0 0")), AFRAME.utils.entity.setComponentProperty(r.arData[t].logo, "animation__pos3", { property: "position", dir: "alternate", dur: 400, easing: "easeInOutQuart", loop: !1, from: i[t].x + " " + (i[t].Pos.y + i[t].Scale.h * f / 5) + " " + i[t].Pos.z, to: i[t].Pos.x + " " + i[t].Pos.y + " " + i[t].Pos.z, startEvents: "pos3" }), AFRAME.utils.entity.setComponentProperty(r.arData[t].logo, "animation__scale3", { property: "scale", dir: "alternate", dur: 400, easing: "easeOutQuad", loop: !1, from: i[t].Scale.x * 1.2 + " " + i[t].Scale.y * .8 + " " + i[t].Scale.z, to: i[t].Scale.x * .8 + " " + i[t].Scale.y * 1.2 + " " + i[t].Scale.z, startEvents: "scale3" }))) : u[n].isAnime != 99 && AFRAME.utils.entity.setComponentProperty(r.arData[t].logo, "animation__turn0", { property: "rotation", dur: 3e3, easing: "easeOutElastic", elasticity: 300, from: "0 0 0", to: "0 360 0", startEvents: "turn0" })) }, objectDataVal: function (n, t, i) { var r; n != null && (r = document.getElementById("debug1"), r.innerHTML = "WDH: " + Number(n).toFixed(1) + " ∠ " + Number(i).toFixed(1)); t != null && (r = document.getElementById("debug2"), r.innerHTML = "pos X: " + Number(t.x).toFixed(1) + " Y: " + Number(t.y).toFixed(1) + " Z: " + Number(t.z).toFixed(1)) }, addScene: function (n) { var t = this, i = t.arData; t.arData[n].shadow && t.wrap[n].appendChild(t.arData[n].shadow); t.arData[n].ashadow && t.wrap[n].appendChild(t.arData[n].ashadow); t.arData[n].bshadow && t.wrap[n].appendChild(t.arData[n].bshadow); t.arData[n].cshadow && t.wrap[n].appendChild(t.arData[n].cshadow); t.arData[n].main && t.wrap[n].appendChild(t.arData[n].main); t.arData[n].amain && t.wrap[n].appendChild(t.arData[n].amain); t.arData[n].bmain && t.wrap[n].appendChild(t.arData[n].bmain); t.arData[n].cmain && t.wrap[n].appendChild(t.arData[n].cmain); i[n].isLogo && t.arData[n].logo && t.wrap[n].appendChild(t.arData[n].logo) }, setScene: function () { var t = this, s = t.arData, i = {}, l, f; for (t.mWrap = {}, n = 0; n < t.arg.Multi; n++) { this.addScene(n); var u = r[n].Scale.y, e = 1, h = -5, o = { x: r[n].Pos.x, y: r[n].Pos.y, z: r[n].Pos.z }; t.arData[n].isPV ? (viewmode = "pv", o.x -= 0, o.y -= s[n].isMp4 ? -1 : -0, o.z -= r[n].Scale.y * 1.5, e = .25, u = r[n].Scale.y * e, AFRAME.utils.entity.setComponentProperty(t.wrap[n], "animation", { property: "scale", dur: 5, easing: "linear", loop: !1, to: u + " " + u + " " + u }), t.wrap[n].setAttribute("rotation", AFRAME.utils.coordinates.stringify(String(h) + " 0 0")), t.wrap[n].setAttribute("position", AFRAME.utils.coordinates.stringify(o)), c = "1", l = document.getElementById("txtMultiNo"), l.innerHTML = c, n > 0 && t.wrap[n].setAttribute("visible", !1), webAr.scene.appendChild(t.wrap[n])) : (f = "", i[n] = document.createElement("a-nft"), s[n].isMarkerType == 1 ? (viewmode = "marker", h = -30, e = t.arg.WZOOM ? Number(t.arg.WZOOM) <= 0 ? .4 : Number(t.arg.WZOOM) : .4, u = u * e, r[n].Pos.y = -5, i[n] = null, i[n] = document.createElement("a-marker"), i[n].setAttribute("markerhandler", ""), i[n].setAttribute("preset", "custom"), i[n].setAttribute("type", "pattern"), i[n].setAttribute("id", "arMarker" + (n + 1).toString()), i[n].setAttribute("data-index", n), f = "pattern/p-def.patt", t.args[n].markerList1 && t.args[n].markerList2 ? f = "pattern/" + t.args[n].markerList1 + "/p-" + t.args[n].markerList2 + ".patt" : t.args[n].MkObjList && t.args[n].markerList2 ? f = "pattern/" + t.args[n].MkObjList + "/p-" + t.args[n].markerList2 + ".patt" : t.args[n].markerList && t.args[n].markerList2 ? f = "pattern/" + t.args[n].markerList + "/p-" + t.args[n].markerList2 + ".patt" : t.args[n].markerList && (f = "pattern/p-" + t.args[n].markerList + ".patt")) : (viewmode = "nft", h = -90, e = t.arg.WZOOM ? Number(t.arg.WZOOM) <= 0 ? 30 : Number(t.arg.WZOOM) : 30, u = u * e, i[n].setAttribute("markerhandler", ""), i[n].setAttribute("preset", "custom"), i[n].setAttribute("type", "nft"), i[n].setAttribute("id", "arMarker" + (n + 1).toString()), i[n].setAttribute("smooth", "true"), i[n].setAttribute("smoothCount", "10"), i[n].setAttribute("smoothTolerance", "0.01"), i[n].setAttribute("smoothThreshold", "5"), i[n].setAttribute("data-index", n), t.args[n].markerList1 && t.args[n].markerList2 ? f = "ImageDescriptors/" + t.args[n].markerList1 + "/" + t.args[n].markerList2 + "/" + t.args[n].markerList2 : t.args[n].MkObjList && t.args[n].markerList2 ? f = "ImageDescriptors/" + t.args[n].MkObjList + "/" + t.args[n].markerList2 + "/" + t.args[n].markerList2 : t.args[n].markerList && t.args[n].markerList2 ? f = "ImageDescriptors/" + t.args[n].markerList + "/" + t.args[n].markerList2 + "/" + t.args[n].markerList2 : t.args[n].markerList ? f = "ImageDescriptors/" + t.args[n].markerList + "/" + t.args[n].markerList : t.args[n].MkObjList && (f = "ImageDescriptors/" + t.args[n].MkObjList + "/01")), t.wrap[n].setAttribute("rotation", AFRAME.utils.coordinates.stringify(String(h) + " 0 0")), i[n].addEventListener("markerFound", function (n) { var f = n.target || n.srcElement, e = f.id, o = document.getElementById(e.toString()), t = Number(o.getAttribute("data-index")), r, i, u; if (webAr.ar.arData[t].isMp4) webAr.markerIdx == "" && (webAr.ar.arData[t].wrap.setAttribute("visible", !0), webAr.ar.arData[t].viewIdx = 1, webAr.markerIdx += (t + 1).toString(), r = document.querySelector("#source" + ((Number(t) + 1) * 100 + webAr.ar.arData[t].srcno.obj).toString()), webAr.ar.videoState[t] < 2 ? (document.getElementById("swPlay").style.display = "inline", webAr.ar.videoState[t] = 1, r.pause()) : (webAr.ar.videoState[t] = 3, r.play())); else for (webAr.ar.arData[t].viewIdx = 1, webAr.markerIdx = "", i = 0; i < webAr.ar.arg.Multi; i++)!webAr.ar.arData[i].viewIdx || (webAr.markerIdx != "" && (webAr.markerIdx += ","), webAr.markerIdx += (i + 1).toString()); u = document.getElementById("txtMultiNo"); u.innerHTML = webAr.markerIdx }), i[n].addEventListener("markerLost", function (n) { var f = n.target || n.srcElement, e = f.id, o = document.getElementById(e.toString()), t = Number(o.getAttribute("data-index")), r, i, u; for (webAr.ar.arData[t].isMp4 && (webAr.ar.arData[t].wrap.setAttribute("visible", !1), r = document.querySelector("#source" + ((Number(t) + 1) * 100 + webAr.ar.arData[t].srcno.obj).toString()), webAr.ar.videoState[t] < 2 ? document.getElementById("swPlay").style.display = "none" : (r.pause(), webAr.ar.videoState[t] = 2)), webAr.ar.arData[t].viewIdx = 0, webAr.markerIdx = "", i = 0; i < webAr.ar.arg.Multi; i++)!webAr.ar.arData[i].viewIdx || (webAr.markerIdx != "" && (webAr.markerIdx += ","), webAr.markerIdx += (i + 1).toString()); u = document.getElementById("txtMultiNo"); u.innerHTML = webAr.markerIdx; webAr.markerIdx == "" && webAr.ar.resetGyro() }), AFRAME.utils.entity.setComponentProperty(t.wrap[n], "animation", { property: "scale", dur: 5, easing: "linear", loop: !1, to: u + " " + u + " " + u }), o = { x: r[n].Pos.x, y: r[n].Pos.y, z: r[n].Pos.z }, t.wrap[n].setAttribute("position", AFRAME.utils.coordinates.stringify(o)), i[n].setAttribute("url", AFRAME.utils.coordinates.stringify(rootPath + f)), i[n].appendChild(t.wrap[n]), webAr.scene.appendChild(i[n]), t.mWrap[n] = i[n]); !s[n].isLogo || this.createAnimation(n); t.arData[n].yClickRate = !!(s[n].isMarkerType == 1) || !!s[n].isPV ? .2 : 5; t.arData[n].yTouchRate = !!(s[n].isMarkerType == 1) || !!s[n].isPV ? .02 : .1 * e; t.arData[n].wrapPos = o; t.arData[n].zoomRateH = u; t.arData[n].wrapZoom = e; t.arData[n].pvAngle = h; this.objectDataVal(u, o, h) } }, setWrapAnime: function (n) { function t(n, t) { return n = Math.ceil(n), t = Math.floor(t), Math.floor(Math.random() * (t - n + 1) + n) } var r = this, u = t(0, 1), i = 1; t == 0 ? AFRAME.utils.entity.setComponentProperty(webAr.ar.arData[n].wrap, "animation__pos0", { property: "position", dir: "alternate", dur: 5e3, easing: "easeInOutQuart", loop: !1, from: webAr.defwrapPos.x + " " + (webAr.defwrapPos.y - webAr.defwrapScale.h * i * 3) + " " + webAr.defwrapPos.z, to: webAr.ar.arData[n].wrapPos.x + " " + webAr.ar.arData[n].wrapPos.y + " " + webAr.ar.arData[n].wrapPos.z, startEvents: "pos0" }) : t == 1 && AFRAME.utils.entity.setComponentProperty(webAr.ar.arData[n].wrap, "animation__pos0", { property: "position", dir: "alternate", dur: 5e3, easing: "easeInOutQuart", loop: !1, from: webAr.defwrapPos.x + " " + (webAr.defwrapPos.y + webAr.defwrapScale.h * i * 3) + " " + webAr.defwrapPos.z, to: webAr.ar.arData[n].wrapPos.x + " " + webAr.ar.arData[n].wrapPos.y + " " + webAr.ar.arData[n].wrapPos.z, startEvents: "pos0" }); webAr.ar.arData[n].wrap.emit("pos0") }, resetScene: function (n) { var i = this, t = i.arData; this.addScene(n); t[n].isMp4 || (document.getElementById("swPlay").style.display = "none"); !t[n].isLogo || this.createAnimation(n); this.objectDataVal(webAr.ar.arData[n].zoomRateH, webAr.ar.arData[n].wrapPos, webAr.ar.arData[n].pvAngle) }, setOverturnEvents: function () { function u(n) { for (var t, r = webAr.markerIdx.split(","), i = 0; i < r.length; i++)t = Number(r[i]) - 1, webAr.ar.arData[t].pvAngle += webAr.ar.arData[t].pvAngle + n > 360 ? n - 360 : webAr.ar.arData[t].pvAngle + n < -360 ? n + 360 : n, webAr.ar.arData[t].wrap.setAttribute("rotation", AFRAME.utils.coordinates.stringify(webAr.ar.arData[t].pvAngle.toString() + " 0 0")), webAr.ar.objectDataVal(webAr.ar.arData[t].zoomRateH, webAr.ar.arData[t].wrapPos, webAr.ar.arData[t].pvAngle) } var n = this, i = document.getElementById("swR90"), r = document.getElementById("swR00"), t; i.addEventListener("click", function () { u(-s) }); r.addEventListener("click", function () { u(s) }); i.addEventListener(n.eventNames.start, n => { n.preventDefault(), t = setInterval(() => { u(-(s * .1)) }, 10) }); i.addEventListener(n.eventNames.end, n => { n.preventDefault(), clearInterval(t) }); i.addEventListener(n.eventNames.move, n => { n.preventDefault(), clearInterval(t) }); r.addEventListener(n.eventNames.start, n => { n.preventDefault(), t = setInterval(() => { u(s * .1) }, 10) }); r.addEventListener(n.eventNames.end, n => { n.preventDefault(), clearInterval(t) }); r.addEventListener(n.eventNames.move, n => { n.preventDefault(), clearInterval(t) }) }, setResizeEvents: function () { var t = this, n; webAr.scene.addEventListener(t.eventNames.start, function (t) { var i = t.changedTouches ? t.changedTouches[0] : t; o = 0; n = i.pageY }); webAr.scene.addEventListener(t.eventNames.move, function (t) { var f = t.changedTouches ? t.changedTouches[0] : t, u, r, i, e, s, h; if (n) for (tapclicked = !!(tapCount = o), o = 1, u = webAr.markerIdx.split(","), r = 0; r < u.length; r++)i = Number(u[r]) - 1, e = webAr.ar.arData[i].zoomRateH, e + (n - f.pageY) / webAr.scene.clientHeight / 5 > .1 && (s = (n - f.pageY) / webAr.scene.clientHeight / 5 * webAr.ar.arData[i].wrapZoom, webAr.ar.arData[i].zoomRateH += s, AFRAME.utils.entity.setComponentProperty(webAr.ar.arData[i].wrap, "animation", { property: "scale", dur: 5, easing: "linear", loop: !1, to: webAr.ar.arData[i].zoomRateH + " " + webAr.ar.arData[i].zoomRateH + " " + webAr.ar.arData[i].zoomRateH }), h = document.getElementById("debug1"), h.innerHTML = "Scale: " + Number(webAr.ar.arData[i].zoomRateH).toFixed(1)) }); webAr.scene.addEventListener(t.eventNames.end, function () { o = 0; n = null }) }, setMoveEvents: function () { function u(n) { for (var t, r = webAr.markerIdx.split(","), i = 0; i < r.length; i++)t = Number(r[i]) - 1, webAr.ar.arData[t].wrapPos = AFRAME.utils.coordinates.parse(webAr.ar.arData[t].wrap.getAttribute("position")); for (i = 0; i < r.length; i++)t = Number(r[i]) - 1, webAr.ar.arData[t].isMarkerType == 1 || webAr.ar.arData[t].isPV ? n == "up" ? webAr.ar.arData[t].wrapPos.y += webAr.ar.arData[t].yTouchRate : webAr.ar.arData[t].wrapPos.y -= webAr.ar.arData[t].yTouchRate : n == "up" ? webAr.ar.arData[t].wrapPos.z -= webAr.ar.arData[t].yTouchRate : webAr.ar.arData[t].wrapPos.z += webAr.ar.arData[t].yTouchRate; for (i = 0; i < r.length; i++)t = Number(r[i]) - 1, webAr.ar.arData[t].wrap.setAttribute("position", AFRAME.utils.coordinates.stringify(webAr.ar.arData[t].wrapPos)), webAr.ar.objectDataVal(webAr.ar.arData[t].zoomRateH, webAr.ar.arData[t].wrapPos, webAr.ar.arData[t].pvAngle) } var i = this, n = document.getElementById("swUp"), t = document.getElementById("swDown"), r; n.addEventListener("click", function () { u("up") }); t.addEventListener("click", function () { u("down") }); n.addEventListener(i.eventNames.start, t => { t.preventDefault(), n.classList.add("active"), r = setInterval(() => { u("up") }, 10) }); n.addEventListener(i.eventNames.end, t => { t.preventDefault(), n.classList.remove("active"), clearInterval(r) }); n.addEventListener(i.eventNames.move, t => { t.preventDefault(), n.classList.remove("active"), clearInterval(r) }); t.addEventListener(i.eventNames.start, n => { n.preventDefault(), t.classList.add("active"), r = setInterval(() => { u("down") }, 10) }); t.addEventListener(i.eventNames.end, n => { n.preventDefault(), t.classList.remove("active"), clearInterval(r) }); t.addEventListener(i.eventNames.move, n => { n.preventDefault(), t.classList.remove("active"), clearInterval(r) }) }, setTapEvents: function () { function r(n, t, i) { var e, r, u, f; (n.preventDefault(), e = webAr.markerIdx.split(","), webAr.ar.arData[i].srcno.length != 1) && (webAr.ar.arData[i].isMp4 || (r = document.getElementById("shadow" + (Number(i) + 1).toString()), r != null && r.remove(), u = document.getElementById("main" + (Number(i) + 1).toString()), u != null && u.remove(), f = document.getElementById("logo" + (Number(i) + 1).toString()), f != null && f.remove(), webAr.ar.arData[i].srcno.obj = t, webAr.ar.resetModel(i, webAr.ar.arData[i].srcno.obj), webAr.ar.resetScene(i), webAr.ar.arData[i].wrap.setAttribute("visible", !0), tapCount = 0, tapclicked = !1)) } var t = this, n = t.arData, f = document.getElementById("version1"), u = 350, i; webAr.scene.addEventListener(t.eventNames.start, function (i) { ++tapCount; tapclicked && tapCount > 0 && setTimeout(function () { var u, t, n, f; if (tapclicked && tapCount == 2 && !o) { for (tapclicked = !1, u = webAr.markerIdx.split(","), t = 0; t < u.length; t++)n = Number(u[t]) - 1, f = webAr.ar.arData[n].srcno.obj + 1 <= webAr.ar.arData[n].srcno.length ? webAr.ar.arData[n].srcno.obj + 1 : 1, r(i, f, n); return } if (tapclicked && tapCount >= 3 && !o) { for (tapclicked = !1, u = webAr.markerIdx.split(","), t = 0; t < u.length; t++)n = Number(u[t]) - 1, f = webAr.ar.arData[n].srcno.obj - 1 > 0 ? webAr.ar.arData[n].srcno.obj - 1 : webAr.ar.arData[n].srcno.length, r(i, f, n); return } }, u); tapclicked = !0; setTimeout(function () { var f, u, r; if (tapclicked && tapCount == 1 && !o) for (i.preventDefault(), f = webAr.markerIdx.split(","), u = 0; u < f.length; u++)r = Number(f[u]) - 1, n[r].isAnime ? (n[r].isAnime == 11 && n[r].path && n[r].isAnime == 11 && t.arData[r].logo.emit("turn1"), n[r].isAnime == 12 && n[r].path && n[r].isAnime == 12 && t.arData[r].logo.emit("turn2"), n[r].isAnime == 13 && n[r].path && n[r].isAnime == 13 && (t.arData[r].logo.emit("pos3"), t.arData[r].logo.emit("scale3"))) : !n[r].isLogo || n[r].path && t.arData[r].logo.emit("turn0"); tapCount = 0; tapclicked = !1 }, 750) }); i = document.getElementById("slideshow"); i.addEventListener(t.eventNames.start, function () { var n, t; webAr.loaderEnd == 1 && (document.getElementById("slideshow").style.display = "none", webAr.loaderEnd = 2, n = document.getElementById("slideshow"), n.style.zIndex = "996", t = document.getElementById("slidewrap"), t.style.marginTop = "25%") }) }, setPreviewEvents: function () { var t = this, n = document.getElementById("swMulti"); n.addEventListener("click", function () { var r, n, t, u, i; webAr.ar.arData[0].isPV && (r = webAr.markerIdx.split(","), n = Number(r[0]) - 1, webAr.ar.arData[n].isMp4 && webAr.ar.videoState[n] > 1 && (i = document.querySelector("#source" + ((n + 1) * 100 + webAr.ar.arData[n].srcno.obj).toString()), i.pause(), webAr.ar.videoState[n] = 2), webAr.ar.arData[n].wrap.setAttribute("visible", !1), t = n + 1 < webAr.ar.arg.Multi ? n + 1 : 0, webAr.ar.arData[t].wrap.setAttribute("visible", !0), webAr.ar.objectDataVal(webAr.ar.arData[t].zoomRateH, webAr.ar.arData[n].wrapPos, webAr.ar.arData[n].pvAngle), u = document.getElementById("txtMultiNo"), webAr.markerIdx = (t + 1).toString(), u.innerHTML = webAr.markerIdx, webAr.ar.arData[t].isMp4 && (i = document.querySelector("#source" + ((t + 1) * 100 + webAr.ar.arData[t].srcno.obj).toString()), webAr.ar.videoState[t] != 2 ? (i.pause(), document.getElementById("swPlay").style.display = "inline", document.getElementById("info1").style.display = "none", webAr.ar.videoState[t] = 1) : (i.play(), webAr.ar.videoState[t] = 3))) }) }, setMovieEvents: function () { var t = this, n = document.getElementById("swPlay"); n.addEventListener("click", function () { for (var n, r, i = webAr.markerIdx.split(","), t = 0; t < i.length; t++)n = Number(i[t]) - 1, webAr.ar.arData[n].isMp4 && (r = document.querySelector("#source" + ((n + 1) * 100 + webAr.ar.arData[n].srcno.obj).toString()), r.play(), webAr.ar.videoState[n] = 3); document.getElementById("swPlay").style.display = "none"; document.getElementById("info1").style.display = "none" }); window.addEventListener("focus", function () { var t, n, i; if (webAr.loaderEnd != 0) for (t = webAr.markerIdx.split(","), n = 0; n < t.length; n++)i = Number(t[n]) - 1, webAr.ar.arData[i].isMp4 && webAr.ar.videoState != 3 && (document.getElementById("swPlay").style.display = "inline") }); window.addEventListener("blur", function () { var i, t, n, r; if (webAr.loaderEnd != 0) for (i = webAr.markerIdx.split(","), t = 0; t < i.length; t++)n = Number(i[t]) - 1, webAr.ar.arData[n].isMp4 && (r = document.querySelector("#source" + ((n + 1) * 100 + webAr.ar.arData[n].srcno.obj).toString()), r.pause(), webAr.ar.videoState[n] = webAr.ar.videoState[n] == 3 ? 2 : 1) }) }, setGyroValuEvents: function () { window.addEventListener("deviceorientation", function (n) { var t = document.getElementById("debug3"); t.innerHTML = "dir X: " + Number(n.beta).toFixed(1) + " Y: " + Number(n.gamma).toFixed(1) + " Z: " + Number(n.alpha).toFixed(1) }) }, setDiplayBtn: function () { var n = this, t = n.arData; document.getElementById("swUp").style.display = "inline"; document.getElementById("swDown").style.display = "inline"; document.getElementById("swPlay").style.display = "none"; webAr.ar.arData[0].oType != "mp4" ? (document.getElementById("info1").style.display = "none", document.getElementById("swScrshot").style.display = "inline", document.getElementById("swCamera").style.display = "inline") : (document.getElementById("info1").style.display = "inline", document.getElementById("swScrshot").style.display = "none", document.getElementById("swCamera").style.display = "none"); this.resetGyro() }, setLoaderEvents: function () { var n = document.querySelector("a-assets"); n.addEventListener("loaded", function () { var n, t; webAr.loaderEnd = 1; n = document.getElementById("mloader3"); n.innerHTML = "※ 画面をタップすると表示を開始します。"; webAr.ar.arData[0].isPV && webAr.ar.arData[0].isMp4 && (document.getElementById("swPlay").style.display = "inline", t = document.querySelector("#source101"), t.pause(), webAr.ar.videoState[0] = 1) }) }, resetGyro: function () { var n = document.getElementById("camera-wrapper"), t = document.getElementById("camera"), i = t.getAttribute("rotation").y; n.setAttribute("rotation", { y: -1 * i }) }, positionVec3Logo: function (n, t) { var i = this, r = i.arData[t].size.h / 5, u = i.arData[t].isMp4 ? .25 : 0; return { x: 0, y: -r - u, z: 0 } }, positionVec3: function (n, t) { var i = this, u = i.arData[t].size.h, r = i.arData[t].size.h / 2, f = !i.args[t].pv ? !(i.args[t].isMarkerType == 1) ? 0 : -u * 5 : r; return n === "shadow" ? { x: 0, y: 0, z: -r } : { x: 0, y: r, z: 0 } }, readBaseXml: function (n) { function r(n) { for (var i = [], r = n.getElementsByTagName("ed0"), u = n.getElementsByTagName("ar0"), f = n.getElementsByTagName("pv"), e = n.getElementsByTagName("len"), o = n.getElementsByTagName("wzoom"), s = n.getElementsByTagName("xyz"), h = r.length, t = 0; t < h; t++)i[t] = { ed: r[t].textContent, ar: u[t].textContent, pv: f[t].textContent, len: e[t].textContent, wzoom: o[t].textContent, xyz: s[t].textContent }; return i } var t = new XMLHttpRequest, i = []; return t.onreadystatechange = function () { if (t.readyState == 4 && t.status == 200) { var n = t.responseXML; i = r(n) } }, t.open("GET", n, !1), t.send(null), i }, readPcsXml: function (n) { function r(n) { for (var i = [], u = n.getElementsByTagName("ed1"), f = n.getElementsByTagName("ar1"), r = n.getElementsByTagName("m"), e = n.getElementsByTagName("m1"), o = n.getElementsByTagName("m2"), s = n.getElementsByTagName("mo"), h = n.getElementsByTagName("t"), c = n.getElementsByTagName("xs"), l = n.getElementsByTagName("an"), a = n.getElementsByTagName("wh"), v = n.getElementsByTagName("o"), y = n.getElementsByTagName("o1"), p = n.getElementsByTagName("o2"), w = n.getElementsByTagName("o3"), b = n.getElementsByTagName("oa"), k = n.getElementsByTagName("ob"), d = n.getElementsByTagName("oc"), g = n.getElementsByTagName("oz"), nt = n.getElementsByTagName("oaz"), tt = n.getElementsByTagName("obz"), it = n.getElementsByTagName("ocz"), rt = n.getElementsByTagName("bg"), ut = n.getElementsByTagName("l"), ft = r.length, t = 0; t < ft; t++)i[t] = { ed: u[t].textContent, ar: f[t].textContent, m: r[t].textContent, m1: e[t].textContent, m2: o[t].textContent, mo: s[t].textContent, t: h[t].textContent, xs: c[t].textContent, an: l[t].textContent, wh: a[t].textContent, o: v[t].textContent, o1: y[t].textContent, o2: p[t].textContent, o3: w[t].textContent, oa: b[t].textContent, ob: k[t].textContent, oc: d[t].textContent, oz: g[t].textContent, oaz: nt[t].textContent, obz: tt[t].textContent, ocz: it[t].textContent, bg: rt[t].textContent, l: ut[t].textContent }; return i } var t = new XMLHttpRequest, i = []; return t.onreadystatechange = function () { if (t.readyState == 4 && t.status == 200) { var n = t.responseXML; i = r(n) } }, t.open("GET", n, !1), t.send(null), i }, Err_Exit: function (n) { window.alert(n); location.href = "warning.html" } }, b = { cEle: null, videoDom: null, rLensTimer: null, init: function () { this.cEle = document.getElementById("rightlens"); this.cEle && this.setEvents() }, setEvents: function () { var n = this; webAr.scene.addEventListener("enter-vr", function () { function i() { n.cEle.width = n.videoDom.clientWidth; n.cEle.height = n.videoDom.clientHeight; n.cEle.style.marginTop = n.videoDom.style.marginTop; n.cEle.style.top = n.videoDom.style.top; t.drawImage(n.videoDom, n.videoDom.videoWidth / 10, 0, 9 * n.videoDom.videoWidth / 10, n.videoDom.videoHeight, 0, 0, 9 * n.videoDom.videoWidth / 10 * 1.2, n.videoDom.videoHeight * 1.2) } var t = n.cEle.getContext("2d"); n.videoDom = document.querySelector("video"); n.videoDom.style.left = "-15%"; n.videoDom.style.top = "20%"; n.cEle.style.zIndex = -1; n.rLensTimer = setInterval(i, 1e3 / 60) }); webAr.scene.addEventListener("exit-vr", function () { n.videoDom.style.left = "0px"; n.cEle.style.zIndex = -5; clearInterval(n.rLensTimer) }) } }; webAr.ar = w; webAr.vr = b; webAr.ar.init(); webAr.vr.init(); webAr.ar.setDiplayBtn(!!w.args[0].pv); webAr.srcno = { obj: 1, from: 1, to: 1, length: 1 }; webAr.defAngle = 0; webAr.defPos = a; webAr.defScale = { x: 4, y: 4, z: 4 }; webAr.defwrapPos = v; webAr.defwrapScale = y; webAr.deflogoScale = e; webAr.markerIdx = c; webAr.loaderEnd = p; webAr.ar.setGyroValuEvents(); webAr.ar.setLoaderEvents() })()